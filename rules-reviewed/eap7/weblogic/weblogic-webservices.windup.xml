<?xml version="1.0"?>
<ruleset xmlns="http://windup.jboss.org/schema/jboss-ruleset" id="weblogic-webservices-eap7"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://windup.jboss.org/schema/jboss-ruleset http://windup.jboss.org/schema/jboss-ruleset/windup-jboss-ruleset.xsd">

    <metadata>
        <description>
            This ruleset contains rules to detect WebLogic Web Services code that might require individual attention when migrating to JBoss EAP 7+.
        </description>
        <dependencies>
            <addon id="org.jboss.windup.rules,windup-rules-javaee,2.7.0.Final"/>
            <addon id="org.jboss.windup.rules,windup-rules-java,2.7.0.Final"/>
        </dependencies>
        <sourceTechnology id="weblogic"/>
        <targetTechnology id="eap" versionRange="[7,8)"/>
        <tag>webservice</tag>
    </metadata>
    <rules>
        <rule id="weblogic-webservices-eap7-01000">
            <when>
                <javaclass references="weblogic.wsee.jaxrpc.ServiceImpl">
                    <location>INHERITANCE</location>
                </javaclass>
            </when>
            <perform>
                <hint title="Oracle WebLogic Web Services implementation class" effort="1" category-id="mandatory">
                    <message>
                      <![CDATA[
                      This web service stub uses the Oracle WebLogic Web Services implementation class `weblogic.wsee.jaxrpc.ServiceImpl`.
                      
                      Recommendation:

                      Replace the Oracle WebLogic Web Services stub using the standard Java EE JAX-WS framework. The stub can be regenerated using the JBoss Web Services tools.
                      
                      For more information, see [Developing JAX-WS Web Services](https://access.redhat.com/documentation/en/red-hat-jboss-enterprise-application-platform/7.0/single/developing-web-services-applications/#developing_jax_ws_web_services).
                      ]]>
                    </message>
                    <link href="https://access.redhat.com/documentation/en/red-hat-jboss-enterprise-application-platform/7.0/single/developing-web-services-applications/#developing_jax_ws_web_services" title="Developing JAX-WS Web Services"/>
                    <tag>webservice</tag>
                    <tag>weblogic</tag>
                </hint>
            </perform>
        </rule>
        <rule id="weblogic-webservices-eap7-02000">
            <when>
                <javaclass references="weblogic.wsee.async.AsyncPreCallContext"/>
            </when>
            <perform>
                <hint title="Oracle WebLogic Asynchronous Web Services Client" effort="3" category-id="mandatory">
                    <message>
                      <![CDATA[
                      This application includes the [Oracle WebLogic Asynchronous Web Services Client API](https://docs.oracle.com/cd/E23943_01/web.1111/e15184/asynch.htm).
                      
                      Recommendation: 
                      
                      Replace the Oracle WebLogic Asynchronous Web Services Client with calls to the JAX-WS asynchronous API.

                      For more information, see [JAX-WS Web Service Clients](https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html/Development_Guide/sect-JAX-WS_Web_Service_Clients.html).
                      ]]>
                    </message>
                    <link href="https://docs.oracle.com/cd/E23943_01/web.1111/e15184/asynch.htm" title="Developing Asynchronous Web Services"/>
                    <link href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html/Development_Guide/sect-JAX-WS_Web_Service_Clients.html" title="JAX-WS Web Service Clients"/>
                    <tag>webservice</tag>
                    <tag>client</tag>
                    <tag>weblogic</tag>
                </hint>
            </perform>
        </rule>
        <rule id="weblogic-webservices-eap7-03000">
            <when>
                <javaclass references="weblogic.wsee.connection.transport.http.HttpTransportInfo.setUsername({*})">
                    <location>METHOD_CALL</location>
                </javaclass>
            </when>
            <perform>
                <hint title="Oracle WebLogic Web Services authentication" effort="3" category-id="mandatory">
                    <message>
                      <![CDATA[
                        This application includes Oracle WebLogic Web Services authentication.
                        
                        Recommendation:
                        
                        Replace the Oracle WebLogic Web Services authentication with JAX-WS standard calls. To attach authentication with JBoss EAP, use the following code:

                        ```java
                        URL wsdlURL = new File("resources/jaxws/samples/context/WEB-INF/wsdl/TestEndpoint.wsdl").toURL();
                        QName qname = new QName("http://org.jboss.ws/jaxws/context", "TestEndpointService");
                        Service service = Service.create(wsdlURL, qname);
                        port = (TestEndpoint)service.getPort(TestEndpoint.class);

                        BindingProvider bp = (BindingProvider)port;
                        bp.getRequestContext().put(BindingProvider.USERNAME_PROPERTY, "jsmith");
                        bp.getRequestContext().put(BindingProvider.PASSWORD_PROPERTY, "PaSSw0rd");
                        ```
                      ]]>
                    </message>
                    <link href="https://access.redhat.com/documentation/en/red-hat-jboss-enterprise-application-platform/7.0/single/developing-web-services-applications/#ws_sec_ws" title="Securing JAX-WS Web Services"/>
                    <tag>webservice</tag>
                    <tag>security</tag>
                    <tag>weblogic</tag>
                </hint>
            </perform>
        </rule>

        <rule id="weblogic-webservices-eap7-04000">
            <when>
                <javaclass references="weblogic.wsee.context.WebServiceContext"/>
            </when>
            <perform>
                <hint title="Oracle WebLogic Web Services API - weblogic.wsee.context.WebServiceContext" effort="1" category-id="mandatory">
                    <message>
                      <![CDATA[
                      This application includes the Oracle WebLogic Web Services class `weblogic.wsee.context.WebServiceContext`.
                      
                      Recommendation:
                      
                      Replace the Oracle WebLogic Web Services class `weblogic.wsee.context.WebServiceContext` with the Java Enterprise Edition standard `javax.xml.WebServiceContext` interface.

                      Example code:

                      ```java
                          @Resource
                          private WebServiceContext webServiceContext;
                      ```
                      ]]>
                    </message>
                    <link href="http://docs.oracle.com/javaee/7/api/javax/xml/ws/WebServiceContext.html" title="javax.xml.WebServiceContext Documentation"/>
                    <tag>webservice</tag>
                    <tag>context</tag>
                    <tag>weblogic</tag>
                </hint>
            </perform>
        </rule>
        <rule id="weblogic-webservices-eap7-05000">
            <when>
                <javaclass references="weblogic.wsee.context.ContextNotFoundException"/>
            </when>
            <perform>
                <hint title="Oracle WebLogic Web Services API - ContextNotFoundException" effort="1" category-id="mandatory">
                    <message>
                        This application uses the Oracle WebLogic Web Services exception `weblogic.wsee.context.ContextNotFoundException`.
                        
                        Recommendation:
                        
                        Remove the Oracle WebLogic Web Services exception `weblogic.wsee.context.ContextNotFoundException`.
                        
                    </message>
                    <tag>webservice</tag>
                    <tag>context</tag>
                    <tag>weblogic</tag>
                </hint>
            </perform>
        </rule>

        <rule id="weblogic-webservices-eap7-06000">
            <when>
                <or>
                  <javaclass references="weblogic.wsee.tools.clientgen.{*}"/>
                  <javaclass references="weblogic.webservice.{*}"/>
                </or>
            </when>
            <perform>
                <hint title="Oracle WebLogic Web Services generated client class" effort="1" category-id="mandatory">
                    <message>
                      <![CDATA[
                      This application includes a class that was generated by the Oracle WebLogic Web Services client generator `ClientGen`.
                      
                      Recommendation:
                      
                      Replace this class using an equivalent standard Java EE technology (for example, the EAP 7 `wsconsume` tool, the `wsgen` tool or the CXF tools).
                      ]]>
                    </message>
                    <link href="https://docs.oracle.com/cd/E13222_01/wls/docs90/webserv/anttasks.html#1039270" title="Oracle ClientGen Ant Task Reference"/>
                    <link href="https://access.redhat.com/documentation/en/red-hat-jboss-enterprise-application-platform/7.0/single/developing-web-services-applications/#using_jax_ws_tools" title="Developing Web Services Applications - Using JAX-WS Tools"/>
                    <link href="https://jax-ws.java.net/nonav/2.2.6/docs/ch04.html#tools-wsgen" title="JAX-WS - wsgen"/>
                    <link href="https://cxf.apache.org/docs/tools.html" title="Apache CXF tools"/>
                    <tag>webservice</tag>
                    <tag>client</tag>
                    <tag>weblogic</tag>
                </hint>
            </perform>
        </rule>
        <rule id="weblogic-webservices-07000">
            <when>
                <javaclass references="weblogic.jws.Transactional" >
                    <location>ANNOTATION</location>
                </javaclass>
            </when>
            <perform>
                <hint title="Oracle WebLogic Web Services annotation @Transactional" effort="3" category-id="mandatory">
                    <message>
                        <![CDATA[
                      This application uses the Oracle WebLogic Web Services annotation `@Transactional`.
                      
                      Recommendation:
                      
                      Replace the Oracle WebLogic Web Services annotation `@Transactional` with the standard Java EE annotation `@TransactionAttribute`.
                      ]]>
                    </message>
                    <link href="https://docs.oracle.com/middleware/11119/wls/WSREF/annotations.htm#i1058163" title="WebLogic specific Annotations - Transactional"/>
                    <link href="https://access.redhat.com/webassets/avalon/d/red-hat-jboss-enterprise-application-platform/7.0.0/javadocs/javax/ejb/TransactionAttribute.html" title="JBoss EAP 7 - API TransactionAttribute"/>
                    <tag>webservice</tag>
                    <tag>weblogic</tag>
                </hint>
            </perform>
        </rule>
    </rules>
</ruleset>
